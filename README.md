# Система автоматизированного перевода документации

Система для автоматизированного перевода учебной документации из русского языка в различные языки с сохранением структуры и форматирования markdown-файлов. Система использует GPT для валидации качества перевода.

## Основные возможности

- ✅ Рекурсивный обход файлов и обработка .md/.mdx
- ✅ Интеллектуальное разбиение файлов с сохранением логических блоков
- ✅ Сохранение структуры директорий
- ✅ Конфигурация с поддержкой нескольких языков
- ✅ Копирование непереводимых файлов
- ✅ Поддержка фронтматтера в markdown-файлах
- ✅ Параллельная обработка файлов
- ✅ Глоссарий терминов с переводами на разные языки
- ✅ Валидация через GPT с подробным анализом качества перевода
- ✅ Система самообучения с автоматическим улучшением промптов
- ✅ Кэширование результатов перевода для оптимизации
- ✅ Ограничение частоты запросов к API (rate limiting)
- ✅ Подробное логирование процесса выполнения

## Структура проекта

```
minimal_translation/
├── main.py           # Основной скрипт перевода
├── validate.py       # Скрипт валидации переводов
├── config.yaml       # Конфигурационный файл
├── glossary.yaml     # Глоссарий терминов
├── .env              # Переменные окружения
├── README.md         # Документация
├── input/            # Директория для исходных файлов
└── output/           # Директория для переведенных файлов
```

## Настройка и использование

### Предварительные требования

- Python 3.8 или выше
- Установленные зависимости из requirements.txt
- Доступ к OpenAI API или другому совместимому API

### Установка

1. Клонируйте репозиторий:
```bash
git clone https://github.com/yourusername/minimal_translation.git
cd minimal_translation
```

2. Установите зависимости:
```bash
pip install -r requirements.txt
```

3. Создайте файл `.env` с вашим API ключом:
```
OPENAI_API_KEY=ваш_ключ_api
```

### Конфигурация

Система настраивается через файл `config.yaml`. Основные разделы:

#### Общие настройки

```yaml
general:
  max_tokens: 8000  # Максимальное количество токенов для разбиения
  max_workers: 4    # Количество параллельных потоков
```

#### Настройки API

```yaml
api:
  model_name: "gpt-4o-mini"  # Модель для перевода
  base_url: "https://api.openai.com/v1"  # Базовый URL API
```

#### Языковые настройки

Каждый язык имеет свой профиль с системным промптом для перевода и отдельным промптом для валидации:

```yaml
languages:
  en:
    name: "English"
    system_prompt: |
      Translate the following markdown text from Russian to English.
      Preserve all markdown formatting, code blocks, and structure.
      Keep technical terms consistent throughout the translation.
      Do not translate code snippets, variable names, or commands inside code blocks.
      
      IMPORTANT: Return ONLY the translated text without any explanations, comments, or additional information.
      Do not include the original Russian text in your response.
      Do not add any explanations about your translation process.
    validation_prompt: |
      You are an expert in validating translations. Check the quality of the translation according to the following glossary:
      
      Check:
      1. Consistency with glossary terms (very important!) - mark terms that DO NOT match the glossary
      2. Preservation of formatting
      3. Translation accuracy
      4. Preservation of technical terms
```

### Глоссарий

Глоссарий терминов настраивается в файле `glossary.yaml`. Система использует этот глоссарий для обеспечения согласованности перевода специфических терминов:

```yaml
terms:
  промпт:
    en: "prompt"
    ru: "промпт"
    zh: "提示词"
    es: "prompt"
  
  токен:
    en: "token"
    ru: "токен"
    zh: "令牌"
    es: "token"
    
  # Другие термины...
```

### Пошаговое использование

#### 1. Подготовка файлов для перевода

Разместите исходные markdown-файлы в директории `input/`. Структура вложенных папок будет сохранена в результатах перевода.

Пример структуры:
```
input/
├── module1/
│   ├── lesson1.md
│   └── lesson2.md
└── module2/
    └── lesson1.md
```

#### 2. Выбор языка перевода

Укажите целевой язык перевода в файле `.env`:
```
TARGET_LANGUAGE=en  # Доступные варианты: en, es, zh
```

Или передайте язык как аргумент командной строки при запуске:
```bash
python main.py --language en
```

#### 3. Выполнение перевода

Запустите процесс перевода:
```bash
python main.py
```

Во время выполнения система будет выводить информацию о прогрессе перевода:
```
2023-04-15 14:30:15 - INFO: Начало перевода файлов
2023-04-15 14:30:16 - INFO: Обработка файла: module1/lesson1.md (1/3)
2023-04-15 14:30:45 - INFO: Обработка файла: module1/lesson2.md (2/3)
2023-04-15 14:31:20 - INFO: Обработка файла: module2/lesson1.md (3/3)
2023-04-15 14:31:55 - INFO: Перевод завершен. Обработано файлов: 3
```

#### 4. Валидация перевода

После завершения перевода запустите валидацию:
```bash
python validate.py
```

Система проанализирует качество перевода и создаст отчет с выявленными проблемами:
```
2023-04-15 14:32:00 - INFO: Начало валидации переводов
2023-04-15 14:32:01 - INFO: Валидация файла: module1/lesson1.md (1/3)
2023-04-15 14:32:30 - INFO: Валидация файла: module1/lesson2.md (2/3)
2023-04-15 14:33:05 - INFO: Валидация файла: module2/lesson1.md (3/3)
2023-04-15 14:33:40 - INFO: Валидация завершена. Найдено проблем: 5
```

#### 5. Просмотр результатов

- Переведенные файлы будут сохранены в директории `output/[язык]/`
- Отчет о валидации будет сохранен в файле `validation_report_[язык].json`
- Улучшения промптов на основе валидации сохраняются в `prompt_improvements/prompt_improvements_[язык].json`

### Примеры использования

#### Перевод всех файлов на английский язык:
```bash
python main.py --language en
```

#### Перевод только определенной директории:
```bash
python main.py --language en --input_dir input/module1 --output_dir output/en/module1
```

#### Валидация переводов с сохранением отчета:
```bash
python validate.py --language en --report validation_report_en.json
```

#### Перевод с подробным логированием:
```bash
python main.py --language en --verbose
```

## Особенности и улучшения

### Интеллектуальное разбиение по маркдаун-структуре

Система учитывает структуру markdown при разбиении больших файлов:
- Не разрывает заголовки от содержимого
- Сохраняет целостность списков и таблиц
- Поддерживает блоки кода

### Система самообучения

- Автоматически накапливает и анализирует проблемы перевода
- Улучшает промпты для будущих переводов на основе отзывов валидации
- Сохраняет проблемные места в `prompt_improvements/prompt_improvements_[язык].json`

### Система "памяти" между частями

- Сохраняет контекст между частями разбитого файла
- Обеспечивает согласованность терминологии в больших документах
- Отслеживает уже переведенные термины для последовательности

## Отладка и мониторинг

### Логирование

Система поддерживает подробное логирование всех операций:
```bash
python main.py --log_level DEBUG
```

### Проверка статуса кэша

Для проверки количества сохраненных в кэше переводов:
```bash
python main.py --cache_stats
```

### Очистка кэша

Для очистки кэша переводов:
```bash
python main.py --clear_cache
```

## Устранение неполадок

### Проблема: Превышение лимита запросов к API

**Решение:** Уменьшите количество параллельных потоков в config.yaml:
```yaml
general:
  max_workers: 2  # Уменьшено с 4
```

### Проблема: Неправильное разбиение файлов

**Решение:** Увеличьте максимальное количество токенов в config.yaml:
```yaml
general:
  max_tokens: 12000  # Увеличено с 8000
```

### Проблема: Ошибки в переводе специфических терминов

**Решение:** Добавьте проблемные термины в глоссарий (glossary.yaml):
```yaml
terms:
  проблемный_термин:
    en: "correct_translation"
    es: "traducción_correcta"
    zh: "正确翻译"
```

## Лицензия

MIT 